sudo: required
dist: trusty

# Tricks to avoid unnecessary cache updates
before_cache:
  - find $HOME/.sbt -name "*.lock" | xargs rm
  - find $HOME/.ivy2 -name "ivydata-*.properties" | xargs rm

# These directories are cached to S3 at the end of the build
cache:
  directories:
    - $HOME/.ivy2/cache
    - $HOME/.ivy2/local
    - $HOME/.sbt/boot

# dependencies for integration tests
addons:
  apt:
    sources:
      - boost-latest
      - ubuntu-toolchain-r-test
    packages:
      - build-essential
      - gcc-4.8
      - g++-4.8
      - libstdc++6-4.6-dev
      - libboost1.55-dev

env:
  global:
    - CXX="g++-4.8"
    - CC="gcc-4.8"
    - secure: YHeBrU79+CwP5VCsX57b+T94ppeTBC2EWgRmtYV/XksUrqJlEphEiMHJl2axMUzBy3BES+IjUuwxe4rkPtkj/lE0md0n1JXhbhzq1s6kTjb3qOmaBrWGZKzhRo5S5FcjBoTbm7k9YeHRHztGzeTJnpLFYpTWLLLoWhH8rXxBWrN2gmn6dMYWS1j1jYpLkaCHqLpAhRW333k63nrK+nq+cGUWOTi/FVQoCq29agX1n2xmj7yDnZpt21t7eNSYT2AqnJHw96JTblbMYIZbocCNcEqfKS1SBCxE7572w8aZzFI517AjCSas7F/wOqmY8hdua5KwhKOIApuhU79rnHmXHkwvBNdoCCc1MlWnWYtISRNTjgL2SIpd5rfcX2g99XsLK8PbU9I6tfstL6kvMkB/NFEZ46XHTNgJxrFSD6tGA5upulq02pZogOP/Ejx7/7qwQE6Exr3vpGkyhTkho+XhoTqATnPnJy/ZvDFPuoGqqoKR8wKnFHLkaAytz5gZqrvmlEn85+r9fK888Nhk07E0eVik+2VU3Wzp4oygMGOOmBmZnYIJqrcNpPgIJr0VAdAhbVNvspJICPhXqAOCSOnDq5v/goP2iM1B78BcA2LljtZJBplhegvb674dCsws0dxpDKIQjnd+0tw/NWV4F4tfwcIqk4XnkPgsiYb9vdQe7K0=
    - secure: v4CqzMNhgcmSFQdMTiYJPPC928s8oz79tK1pvAPvBV4rQ8JRo6+14HWsaUHUxCIzoTiKT8Ivb10PV/UHW0/DEaA931kqfepWaVACWYdth5qY+cs+q41OYe1qHP+gwHwy60gd7N+1/I0/xIlSdc2JX2nelxC99NkyOCB30YfntiDsPsKW+2/jd3CaySwnqy4qPzW0bEq/eLVO2/PAdjpNjvpFlfW3yl0kqeeyqinf1K/ImntvJhKjdTeiqvg0ppJmrahojxv4fXd19C6Du9LZk4V5+m+wF39VSf3El9QYOqSFDMVeohpKbbdQATnuyXkGfZe1R/Ifs3DI8oU2ltGAs5gXHoNGZx9xfw3k44SRmRIOKlLIG1zxjA16Cal93xdgYNkh173djsY9JHdRr9aM9gDmN/sfgZLFX6bmgGU0TmLPcByBGRKy4B/iOcLPtdX+2k/Rzax73mxkiglHqcdaJG1II2Rk7gTsmzk626vlMJoJCKq19ZuyhFJytd/V/sj503BEhGvmpf2WfLi4vkRCj1mzcpkiTeiLCJkLXFvIlajrTShK3bYGYDL56O1exTZZM15DY3oT24YP6eSa5+edZKbV5zLiqUTFeiho4ISy7r0/mdQr/90x5ZD3lNps0Vj7Ichjtcii+SDwmgaY/BIZsb51NbtWXDeQpnRfrwdjyh8=
  matrix:
    - TEST_SUITE=test
#    - TEST_SUITE=it:test

language: scala

jdk:
  - oraclejdk8

install:
  - if test ! -d "$HOME/.ivy2/local/org.scala-lang.lms"; then
      git clone "https://github.com/scalan/virtualization-lms-core.git" &&
      (cd virtualization-lms-core && sbt publishLocal);
    fi

script:
  - sbt -jvm-opts .travis.jvmopts $TEST_SUITE

after_success:
  - sbt -jvm-opts .travis.jvmopts publish
